// assets/js/team-dashboard.js

// 1. 球場分區 GeoJSON 數據
const courtPolygonsData = {
    "type": "FeatureCollection",
    "name": "polygons",
    "features": [{
            "type": "Feature",
            "properties": { "name": "Restricted Area" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [290.0, 53.0],
                        [289.979861695327372, 54.269117339922708],
                        [289.919467058875398, 55.536956786262579],
                        [289.818876902923364, 56.802241732167303],
                        [289.678192513231807, 58.063698142949974],
                        [289.497555547055754, 59.320055838933996],
                        [289.277147890508274, 60.570049774416411],
                        [289.017191475416269, 61.812421311461627],
                        [288.717948055854265, 63.045919487243168],
                        [288.379718944579906, 64.269302273657189],
                        [288.002844709637827, 65.481337827939484],
                        [287.587704831436326, 66.680805733026745],
                        [287.134717320642892, 67.8664982264131],
                        [286.644338297282786, 69.037221416264543],
                        [286.117061531464856, 70.191796483566861],
                        [285.55341794619693, 71.329060869096423],
                        [284.953975082791374, 72.44786944401875],
                        [284.319336529399095, 73.547095662936243],
                        [283.650141313247218, 74.62563269822391],
                        [282.947063257193292, 75.682394554510836],
                        [282.210810301242361, 76.716317162185618],
                        [281.442123789711502, 77.726359448824212],
                        [280.641777724759095, 78.711504387461574],
                        [279.810577987030172, 79.67076002065167],
                        [278.9493615242028, 80.603160459284481],
                        [278.058995508252849, 81.507766855154514],
                        [277.140376462285303, 82.383668346301334],
                        [276.194429357811373, 83.229982974170326],
                        [275.2221066833809, 84.045858571670266],
                        [274.224387485506668, 84.830473621233281],
                        [273.202276382847913, 85.583038082013431],
                        [272.156802554644401, 86.302794185390866],
                        [271.089018704420084, 86.989017197980573],
                        [270.0, 87.641016151377556],
                        [268.890842990907288, 88.258134537903288],
                        [267.762664504230941, 88.839750971653444],
                        [266.616600520075451, 89.385279814180734],
                        [265.453805027725139, 89.894171764183255],
                        [264.275448863674853, 90.365914410604262],
                        [263.082718532696845, 90.800032748586744],
                        [261.876815013131022, 91.196089657762954],
                        [260.658952547601416, 91.553686342397683],
                        [259.430357420377106, 91.872462732941671],
                        [258.192266722607656, 92.152097848591154],
                        [256.945927106677232, 92.392310120488318],
                        [255.69259353093139, 92.592857675237298],
                        [254.433527996040453, 92.753538578450161],
                        [253.169998274271535, 92.874191038077697],
                        [251.903276632949684, 92.954693567320319],
                        [250.634638553392307, 92.994965106954993],
                        [249.365361446607665, 92.994965106954993],
                        [248.096723367050316, 92.954693567320319],
                        [246.830001725728465, 92.874191038077697],
                        [245.566472003959575, 92.753538578450161],
                        [244.307406469068582, 92.592857675237298],
                        [243.054072893322797, 92.392310120488318],
                        [241.807733277392373, 92.152097848591154],
                        [240.569642579622922, 91.872462732941671],
                        [239.341047452398584, 91.553686342397683],
                        [238.123184986869006, 91.196089657762954],
                        [236.917281467303127, 90.800032748586744],
                        [235.724551136325118, 90.365914410604262],
                        [234.546194972274861, 89.894171764183255],
                        [233.383399479924549, 89.385279814180734],
                        [232.237335495769031, 88.839750971653444],
                        [231.109157009092712, 88.258134537903288],
                        [230.0, 87.641016151377542],
                        [228.910981295579916, 86.989017197980573],
                        [227.843197445355599, 86.302794185390866],
                        [226.797723617152087, 85.583038082013431],
                        [225.775612514493332, 84.830473621233281],
                        [224.7778933166191, 84.045858571670266],
                        [223.805570642188599, 83.229982974170326],
                        [222.859623537714725, 82.383668346301334],
                        [221.941004491747151, 81.5077668551545],
                        [221.0506384757972, 80.603160459284481],
                        [220.189422012969828, 79.67076002065167],
                        [219.358222275240877, 78.711504387461588],
                        [218.557876210288498, 77.726359448824212],
                        [217.789189698757639, 76.716317162185618],
                        [217.052936742806708, 75.682394554510836],
                        [216.349858686752754, 74.625632698223896],
                        [215.680663470600905, 73.547095662936243],
                        [215.046024917208598, 72.44786944401875],
                        [214.44658205380307, 71.329060869096423],
                        [213.882938468535144, 70.191796483566861],
                        [213.355661702717214, 69.037221416264543],
                        [212.865282679357108, 67.8664982264131],
                        [212.412295168563674, 66.680805733026759],
                        [211.997155290362173, 65.481337827939484],
                        [211.620281055420094, 64.269302273657189],
                        [211.282051944145735, 63.045919487243168],
                        [210.982808524583731, 61.812421311461634],
                        [210.722852109491726, 60.570049774416404],
                        [210.502444452944246, 59.320055838933996],
                        [210.321807486768193, 58.063698142949974],
                        [210.181123097076608, 56.802241732167296],
                        [210.08053294112463, 55.536956786262579],
                        [210.020138304672599, 54.269117339922708],
                        [210.0, 53.0],
                        [210.0, 53.0],
                        [210.0, 1.0],
                        [290.0, 1.0],
                        [290.0, 53.0]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "Left Low Post" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [113.0, 53.0],
                        [113.0, 53.0],
                        [113.068973693503636, 57.346726889235271],
                        [113.275825323351825, 61.689076992949325],
                        [113.62034660748742, 66.022677932672991],
                        [114.102190642181029, 70.343166139603667],
                        [114.720872251333986, 74.646191248348941],
                        [115.475768475009176, 78.927420477376188],
                        [116.366119196699231, 83.182542991756094],
                        [117.391027908699186, 87.407274243807862],
                        [118.549462614813848, 91.597360287275862],
                        [119.840256869490474, 95.748582060692712],
                        [121.262110952330573, 99.85675963561664],
                        [122.813593176798065, 103.917756425464887],
                        [124.49314133180647, 107.927483350706069],
                        [126.299064254732883, 111.881902956216493],
                        [128.229543534275479, 115.777033476655248],
                        [130.282635341439459, 119.608952845764207],
                        [132.456272386808138, 123.373802645556665],
                        [134.748266002128162, 127.067791991416854],
                        [137.156308344112915, 130.687201349199597],
                        [139.677974718244968, 134.228386280485722],
                        [142.310726020238121, 137.687781112222922],
                        [145.051911292700026, 141.061902527055906],
                        [147.898770394421604, 144.34735307073197],
                        [150.848436779605379, 147.540824573049349],
                        [153.135516499042865, 149.864483500957135],
                        [221.718398977822744, 81.281601022177256],
                        [221.0506384757972, 80.603160459284481],
                        [220.189422012969828, 79.67076002065167],
                        [219.358222275240877, 78.711504387461588],
                        [218.557876210288498, 77.726359448824212],
                        [217.789189698757639, 76.716317162185618],
                        [217.052936742806708, 75.682394554510836],
                        [216.349858686752754, 74.625632698223896],
                        [215.680663470600905, 73.547095662936243],
                        [215.046024917208598, 72.44786944401875],
                        [214.44658205380307, 71.329060869096423],
                        [213.882938468535144, 70.191796483566861],
                        [213.355661702717214, 69.037221416264543],
                        [212.865282679357108, 67.8664982264131],
                        [212.412295168563674, 66.680805733026759],
                        [211.997155290362173, 65.481337827939484],
                        [211.620281055420094, 64.269302273657189],
                        [211.282051944145735, 63.045919487243168],
                        [210.982808524583731, 61.812421311461634],
                        [210.722852109491726, 60.570049774416404],
                        [210.502444452944246, 59.320055838933996],
                        [210.321807486768193, 58.063698142949974],
                        [210.181123097076608, 56.802241732167296],
                        [210.08053294112463, 55.536956786262579],
                        [210.020138304672599, 54.269117339922708],
                        [210.0, 53.0],
                        [210.0, 53.0],
                        [210.0, 1.0],
                        [113.0, 1.0],
                        [113.0, 53.0]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "Mid High Post" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [153.897940384233976, 150.639101478904195],
                        [157.044210616672899, 153.639064086082072],
                        [160.284079449495948, 156.537691686533378],
                        [163.614284609420423, 159.332065607970662],
                        [167.031472862139651, 162.019372152723975],
                        [170.53220338874587, 164.596905430896015],
                        [174.112951250342888, 167.062070084963693],
                        [177.770110937361153, 169.412383903083452],
                        [181.5, 171.645480318468088],
                        [185.298862756142483, 173.759110792318751],
                        [189.162874073008936, 175.751147077913004],
                        [193.088143218741578, 177.619583363569006],
                        [197.070717780041377, 179.362538292327656],
                        [201.106587641913563, 180.978256856319632],
                        [205.191689025513227, 182.465112163909566],
                        [209.32190858002636, 183.821607077838109],
                        [213.49308752446521, 185.046375722712071],
                        [217.701025835208469, 186.138184860325197],
                        [221.941486475068871, 187.095935131424682],
                        [226.210199659630547, 187.91866216267249],
                        [230.502867156559915, 188.605537537687781],
                        [234.815166613561502, 189.15586963119182],
                        [239.142755910619968, 189.569104305416118],
                        [243.481277532147317, 189.844825468072088],
                        [247.826362954631293, 189.982755491320887],
                        [252.173637045368679, 189.982755491320887],
                        [256.518722467852683, 189.844825468072088],
                        [260.857244089380004, 189.569104305416118],
                        [265.184833386438527, 189.15586963119182],
                        [269.497132843440056, 188.605537537687781],
                        [273.789800340369482, 187.91866216267249],
                        [278.058513524931129, 187.095935131424682],
                        [282.298974164791559, 186.138184860325197],
                        [286.506912475534818, 185.046375722712071],
                        [290.678091419973669, 183.821607077838109],
                        [294.808310974486744, 182.465112163909566],
                        [298.893412358086437, 180.978256856319604],
                        [302.929282219958623, 179.362538292327656],
                        [306.91185678125845, 177.619583363569006],
                        [310.837125926991064, 175.751147077913004],
                        [314.701137243857545, 173.759110792318751],
                        [318.5, 171.645480318468117],
                        [322.22988906263879, 169.41238390308348],
                        [325.887048749657083, 167.062070084963693],
                        [329.46779661125413, 164.596905430896015],
                        [332.968527137860292, 162.019372152724003],
                        [336.385715390579549, 159.332065607970691],
                        [339.715920550504052, 156.537691686533378],
                        [342.955789383327101, 153.639064086082044],
                        [346.102059615765995, 150.639101478904223],
                        [346.864483500957135, 149.864483500957135],
                        [278.281601022177256, 81.281601022177256],
                        [278.058995508252849, 81.507766855154514],
                        [277.140376462285303, 82.383668346301334],
                        [276.194429357811373, 83.229982974170326],
                        [275.2221066833809, 84.045858571670266],
                        [274.224387485506668, 84.830473621233281],
                        [273.202276382847913, 85.583038082013431],
                        [272.156802554644401, 86.302794185390866],
                        [271.089018704420084, 86.989017197980573],
                        [270.0, 87.641016151377556],
                        [268.890842990907288, 88.258134537903288],
                        [267.762664504230941, 88.839750971653444],
                        [266.616600520075451, 89.385279814180734],
                        [265.453805027725139, 89.894171764183255],
                        [264.275448863674853, 90.365914410604262],
                        [263.082718532696845, 90.800032748586744],
                        [261.876815013131022, 91.196089657762954],
                        [260.658952547601416, 91.553686342397683],
                        [259.430357420377106, 91.872462732941671],
                        [258.192266722607656, 92.152097848591154],
                        [256.945927106677232, 92.392310120488318],
                        [255.69259353093139, 92.592857675237298],
                        [254.433527996040453, 92.753538578450161],
                        [253.169998274271535, 92.874191038077697],
                        [251.903276632949684, 92.954693567320319],
                        [250.634638553392307, 92.994965106954993],
                        [249.365361446607665, 92.994965106954993],
                        [248.096723367050316, 92.954693567320319],
                        [246.830001725728465, 92.874191038077697],
                        [245.566472003959575, 92.753538578450161],
                        [244.307406469068582, 92.592857675237298],
                        [243.054072893322797, 92.392310120488318],
                        [241.807733277392373, 92.152097848591154],
                        [240.569642579622922, 91.872462732941671],
                        [239.341047452398584, 91.553686342397683],
                        [238.123184986869006, 91.196089657762954],
                        [236.917281467303127, 90.800032748586744],
                        [235.724551136325118, 90.365914410604262],
                        [234.546194972274861, 89.894171764183255],
                        [233.383399479924549, 89.385279814180734],
                        [232.237335495769031, 88.839750971653444],
                        [231.109157009092712, 88.258134537903288],
                        [230.0, 87.641016151377542],
                        [228.910981295579916, 86.989017197980573],
                        [227.843197445355599, 86.302794185390866],
                        [226.797723617152087, 85.583038082013431],
                        [225.775612514493332, 84.830473621233281],
                        [224.7778933166191, 84.045858571670266],
                        [223.805570642188599, 83.229982974170326],
                        [222.859623537714725, 82.383668346301334],
                        [221.941004491747151, 81.5077668551545],
                        [221.718398977822744, 81.281601022177256],
                        [153.135516499042865, 149.864483500957135],
                        [153.897940384233976, 150.639101478904195]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "Right Low Post" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [349.151563220394621, 147.540824573049349],
                        [352.101229605578396, 144.34735307073197],
                        [354.948088707299974, 141.061902527055878],
                        [357.689273979761879, 137.687781112222922],
                        [360.322025281755032, 134.228386280485722],
                        [362.843691655887085, 130.687201349199597],
                        [365.251733997871838, 127.067791991416868],
                        [367.543727613191891, 123.373802645556665],
                        [369.717364658560541, 119.608952845764207],
                        [371.770456465724521, 115.77703347665522],
                        [373.700935745267088, 111.881902956216521],
                        [375.506858668193559, 107.927483350706069],
                        [377.186406823201935, 103.917756425464887],
                        [378.737889047669455, 99.856759635616612],
                        [380.159743130509526, 95.74858206069274],
                        [381.45053738518618, 91.597360287275862],
                        [382.608972091300814, 87.407274243807848],
                        [383.633880803300769, 83.182542991756065],
                        [384.524231524990796, 78.927420477376202],
                        [385.279127748666042, 74.646191248348941],
                        [385.897809357818971, 70.343166139603653],
                        [386.37965339251258, 66.02267793267302],
                        [386.724174676648204, 61.689076992949339],
                        [386.931026306496392, 57.346726889235271],
                        [387.0, 53.0],
                        [387.0, 1.0],
                        [290.0, 1.0],
                        [290.0, 53.0],
                        [289.979861695327372, 54.269117339922708],
                        [289.919467058875398, 55.536956786262579],
                        [289.818876902923364, 56.802241732167303],
                        [289.678192513231807, 58.063698142949974],
                        [289.497555547055754, 59.320055838933996],
                        [289.277147890508274, 60.570049774416411],
                        [289.017191475416269, 61.812421311461627],
                        [288.717948055854265, 63.045919487243168],
                        [288.379718944579906, 64.269302273657189],
                        [288.002844709637827, 65.481337827939484],
                        [287.587704831436326, 66.680805733026745],
                        [287.134717320642892, 67.8664982264131],
                        [286.644338297282786, 69.037221416264543],
                        [286.117061531464856, 70.191796483566861],
                        [285.55341794619693, 71.329060869096423],
                        [284.953975082791374, 72.44786944401875],
                        [284.319336529399095, 73.547095662936243],
                        [283.650141313247218, 74.62563269822391],
                        [282.947063257193292, 75.682394554510836],
                        [282.210810301242361, 76.716317162185618],
                        [281.442123789711502, 77.726359448824212],
                        [280.641777724759095, 78.711504387461574],
                        [279.810577987030172, 79.67076002065167],
                        [278.9493615242028, 80.603160459284481],
                        [278.281601022177256, 81.281601022177256],
                        [346.864483500957135, 149.864483500957135],
                        [349.151563220394621, 147.540824573049349]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "MidRange Left Conor" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [122.813593176798065, 103.917756425464887],
                        [121.262110952330573, 99.85675963561664],
                        [119.840256869490474, 95.748582060692712],
                        [118.549462614813848, 91.597360287275862],
                        [117.391027908699186, 87.407274243807862],
                        [116.366119196699231, 83.182542991756094],
                        [115.475768475009176, 78.927420477376188],
                        [114.720872251333986, 74.646191248348941],
                        [114.102190642181029, 70.343166139603667],
                        [113.62034660748742, 66.022677932672991],
                        [113.275825323351825, 61.689076992949325],
                        [113.068973693503636, 57.346726889235271],
                        [113.0, 53.0],
                        [113.0, 53.0],
                        [113.0, 1.0],
                        [30.0, 1.0],
                        [30.0, 142.0],
                        [123.005190522922192, 104.375172924817846],
                        [122.813593176798065, 103.917756425464887]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "MidRange Right Conor" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [387.0, 1.0],
                        [387.0, 53.0],
                        [386.931026306496392, 57.346726889235271],
                        [386.724174676648204, 61.689076992949339],
                        [386.37965339251258, 66.02267793267302],
                        [385.897809357818971, 70.343166139603653],
                        [385.279127748666042, 74.646191248348941],
                        [384.524231524990796, 78.927420477376202],
                        [383.633880803300769, 83.182542991756065],
                        [382.608972091300814, 87.407274243807848],
                        [381.45053738518618, 91.597360287275862],
                        [380.159743130509526, 95.74858206069274],
                        [378.737889047669455, 99.856759635616612],
                        [377.186406823201935, 103.917756425464887],
                        [376.994809477077808, 104.375172924817846],
                        [470.0, 142.0],
                        [470.0, 1.0],
                        [387.0, 1.0]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "Mid MidRange" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [298.893412358086437, 180.978256856319604],
                        [294.808310974486744, 182.465112163909566],
                        [290.678091419973669, 183.821607077838109],
                        [286.506912475534818, 185.046375722712071],
                        [282.298974164791559, 186.138184860325197],
                        [278.058513524931129, 187.095935131424682],
                        [273.789800340369482, 187.91866216267249],
                        [269.497132843440056, 188.605537537687781],
                        [265.184833386438527, 189.15586963119182],
                        [260.857244089380004, 189.569104305416118],
                        [256.518722467852683, 189.844825468072088],
                        [252.173637045368679, 189.982755491320887],
                        [247.826362954631293, 189.982755491320887],
                        [243.481277532147317, 189.844825468072088],
                        [239.142755910619968, 189.569104305416118],
                        [234.815166613561502, 189.15586963119182],
                        [230.502867156559915, 188.605537537687781],
                        [226.210199659630547, 187.91866216267249],
                        [221.941486475068871, 187.095935131424682],
                        [217.701025835208469, 186.138184860325197],
                        [213.49308752446521, 185.046375722712071],
                        [209.32190858002636, 183.821607077838109],
                        [205.191689025513227, 182.465112163909566],
                        [201.106587641913563, 180.978256856319632],
                        [197.575257080994561, 179.564525358985804],
                        [159.309021373691337, 271.947390584522907],
                        [165.417965482726402, 274.393042882830287],
                        [172.484892693771087, 276.965194035376385],
                        [179.62987104719889, 279.311831222245473],
                        [186.845706155461698, 281.430591578706299],
                        [194.12513228426576, 283.319341692679359],
                        [201.460819668549789, 284.976179752902567],
                        [208.845381892937525, 286.399437463893264],
                        [216.271383329231412, 287.587681725781067],
                        [223.731346623460411, 288.539716077317223],
                        [231.217760224941117, 289.254581900610333],
                        [238.723085949773093, 289.731559386372851],
                        [246.239766571150483, 289.970168258708384],
                        [253.760233428849489, 289.970168258708384],
                        [261.276914050226878, 289.731559386372851],
                        [268.782239775058883, 289.254581900610333],
                        [276.268653376539646, 288.539716077317223],
                        [283.728616670768588, 287.587681725781067],
                        [291.154618107062504, 286.399437463893264],
                        [298.539180331450211, 284.976179752902567],
                        [305.87486771573424, 283.319341692679359],
                        [313.154293844538302, 281.430591578706299],
                        [320.370128952801167, 279.311831222245473],
                        [327.515107306228913, 276.965194035376385],
                        [334.582034517273655, 274.393042882830287],
                        [340.69097862630872, 271.947390584522907],
                        [302.424742919005439, 179.564525358985804],
                        [298.893412358086437, 180.978256856319604]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "MidRange Left Wing" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [197.070717780041377, 179.362538292327656],
                        [193.088143218741578, 177.619583363569006],
                        [189.162874073008936, 175.751147077913004],
                        [185.298862756142483, 173.759110792318751],
                        [181.5, 171.645480318468088],
                        [177.770110937361153, 169.412383903083452],
                        [174.112951250342888, 167.062070084963693],
                        [170.53220338874587, 164.596905430896015],
                        [167.031472862139651, 162.019372152723975],
                        [163.614284609420423, 159.332065607970662],
                        [160.284079449495948, 156.537691686533378],
                        [157.044210616672899, 153.639064086082072],
                        [153.897940384233976, 150.639101478904195],
                        [150.848436779605379, 147.540824573049349],
                        [147.898770394421604, 144.34735307073197],
                        [145.051911292700026, 141.061902527055906],
                        [142.310726020238121, 137.687781112222922],
                        [139.677974718244968, 134.228386280485722],
                        [137.156308344112915, 130.687201349199597],
                        [134.748266002128162, 127.067791991416854],
                        [132.456272386808138, 123.373802645556665],
                        [130.282635341439459, 119.608952845764207],
                        [128.229543534275479, 115.777033476655248],
                        [126.299064254732883, 111.881902956216493],
                        [124.49314133180647, 107.927483350706069],
                        [122.813593176798065, 103.917756425464887],
                        [123.005190522922192, 104.375172924817846],
                        [30.0, 142.0],
                        [30.360482553302102, 142.0],
                        [32.882295588599504, 148.020536891367442],
                        [36.006410426070744, 154.861394165133618],
                        [39.345998668783153, 161.599685649396292],
                        [42.897697634460968, 168.228626455811082],
                        [46.657931063310428, 174.741541802897302],
                        [50.622912719010031, 181.131873736976587],
                        [54.788650201129656, 187.393187735476687],
                        [59.150948965139094, 193.519179185949781],
                        [63.705416545959366, 199.503679734283423],
                        [68.447466980802233, 205.340663495709862],
                        [73.372325426846146, 211.024253122361102],
                        [78.475032969098351, 216.548725721260524],
                        [83.750451613601825, 221.908518616790474],
                        [89.193269460959698, 227.098234951835423],
                        [94.798006054967459, 232.112649121959208],
                        [100.559017900968172, 236.946712037146341],
                        [106.470504148372953, 241.595556205807185],
                        [112.52651243162606, 246.054500635929571],
                        [118.720944863731859, 250.319055548440815],
                        [125.047564176310914, 254.384926898034877],
                        [131.5, 258.248020696911908],
                        [138.071755278874207, 261.904447137076943],
                        [144.756212812431528, 265.3505245070466],
                        [151.54664191855295, 268.582782899020913],
                        [158.436205210728502, 271.597967702785809],
                        [159.309021373691337, 271.947390584522907],
                        [197.575257080994561, 179.564525358985804],
                        [197.070717780041377, 179.362538292327656]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "MidRange Right Wing" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [373.700935745267088, 111.881902956216521],
                        [371.770456465724521, 115.77703347665522],
                        [369.717364658560541, 119.608952845764207],
                        [367.543727613191891, 123.373802645556665],
                        [365.251733997871838, 127.067791991416868],
                        [362.843691655887085, 130.687201349199597],
                        [360.322025281755032, 134.228386280485722],
                        [357.689273979761879, 137.687781112222922],
                        [354.948088707299974, 141.061902527055878],
                        [352.101229605578396, 144.34735307073197],
                        [349.151563220394621, 147.540824573049349],
                        [346.102059615765995, 150.639101478904223],
                        [342.955789383327101, 153.639064086082044],
                        [339.715920550504052, 156.537691686533378],
                        [336.385715390579549, 159.332065607970691],
                        [332.968527137860292, 162.019372152724003],
                        [329.46779661125413, 164.596905430896015],
                        [325.887048749657083, 167.062070084963693],
                        [322.22988906263879, 169.41238390308348],
                        [318.5, 171.645480318468117],
                        [314.701137243857545, 173.759110792318751],
                        [310.837125926991064, 175.751147077913004],
                        [306.91185678125845, 177.619583363569006],
                        [302.929282219958623, 179.362538292327656],
                        [302.424742919005439, 179.564525358985804],
                        [340.69097862630872, 271.947390584522907],
                        [341.563794789271469, 271.597967702785809],
                        [348.45335808144705, 268.582782899020856],
                        [355.243787187568444, 265.3505245070466],
                        [361.928244721125793, 261.904447137076943],
                        [368.5, 258.248020696911965],
                        [374.952435823689029, 254.384926898034905],
                        [381.279055136268141, 250.319055548440815],
                        [387.473487568373969, 246.054500635929571],
                        [393.529495851626962, 241.595556205807213],
                        [399.440982099031828, 236.946712037146369],
                        [405.201993945032541, 232.112649121959208],
                        [410.806730539040359, 227.098234951835394],
                        [416.249548386398146, 221.908518616790502],
                        [421.524967030901621, 216.548725721260553],
                        [426.627674573153854, 211.024253122361102],
                        [431.552533019197767, 205.340663495709805],
                        [436.294583454040662, 199.503679734283423],
                        [440.849051034860906, 193.519179185949781],
                        [445.211349798870401, 187.393187735476658],
                        [449.37708728098994, 181.131873736976615],
                        [453.342068936689543, 174.741541802897302],
                        [457.102302365539003, 168.228626455811082],
                        [460.654001331216875, 161.599685649396264],
                        [463.993589573929228, 154.861394165133675],
                        [467.117704411400496, 148.020536891367442],
                        [469.63951744669788, 142.0],
                        [470.0, 142.0],
                        [376.994809477077808, 104.375172924817846],
                        [375.506858668193559, 107.927483350706069],
                        [373.700935745267088, 111.881902956216521]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "Left Conor" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [1.0, 1.0],
                        [1.0, 142.0],
                        [30.0, 142.0],
                        [30.0, 1.0],
                        [1.0, 1.0]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "Right Conor" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [499.0, 1.0],
                        [499.0, 142.0],
                        [470.0, 142.0],
                        [470.0, 1.0],
                        [499.0, 1.0]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "Top of the Key" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [422.31284194720763, 469.0],
                        [340.69097862630872, 271.947390584522907],
                        [334.582034517273655, 274.393042882830287],
                        [327.515107306228913, 276.965194035376385],
                        [320.370128952801167, 279.311831222245473],
                        [313.154293844538302, 281.430591578706299],
                        [305.87486771573424, 283.319341692679359],
                        [298.539180331450211, 284.976179752902567],
                        [291.154618107062504, 286.399437463893264],
                        [283.728616670768588, 287.587681725781067],
                        [276.268653376539646, 288.539716077317223],
                        [268.782239775058883, 289.254581900610333],
                        [261.276914050226878, 289.731559386372851],
                        [253.760233428849489, 289.970168258708384],
                        [246.239766571150483, 289.970168258708384],
                        [238.723085949773093, 289.731559386372851],
                        [231.217760224941117, 289.254581900610333],
                        [223.731346623460411, 288.539716077317223],
                        [216.271383329231412, 287.587681725781067],
                        [208.845381892937525, 286.399437463893264],
                        [201.460819668549789, 284.976179752902567],
                        [194.12513228426576, 283.319341692679359],
                        [186.845706155461698, 281.430591578706299],
                        [179.62987104719889, 279.311831222245473],
                        [172.484892693771087, 276.965194035376385],
                        [165.417965482726402, 274.393042882830287],
                        [159.309021373691337, 271.947390584522907],
                        [77.687158052792469, 469.0],
                        [422.31284194720763, 469.0]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "Left Wing" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [77.687158052792469, 469.0],
                        [159.309021373691337, 271.947390584522907],
                        [158.436205210728502, 271.597967702785809],
                        [151.54664191855295, 268.582782899020913],
                        [144.756212812431528, 265.3505245070466],
                        [138.071755278874207, 261.904447137076943],
                        [131.5, 258.248020696911908],
                        [125.047564176310914, 254.384926898034877],
                        [118.720944863731859, 250.319055548440815],
                        [112.52651243162606, 246.054500635929571],
                        [106.470504148372953, 241.595556205807185],
                        [100.559017900968172, 236.946712037146341],
                        [94.798006054967459, 232.112649121959208],
                        [89.193269460959698, 227.098234951835423],
                        [83.750451613601825, 221.908518616790474],
                        [78.475032969098351, 216.548725721260524],
                        [73.372325426846146, 211.024253122361102],
                        [68.447466980802233, 205.340663495709862],
                        [63.705416545959366, 199.503679734283423],
                        [59.150948965139094, 193.519179185949781],
                        [54.788650201129656, 187.393187735476687],
                        [50.622912719010031, 181.131873736976587],
                        [46.657931063310428, 174.741541802897302],
                        [42.897697634460968, 168.228626455811082],
                        [39.345998668783153, 161.599685649396292],
                        [36.006410426070744, 154.861394165133618],
                        [32.882295588599504, 148.020536891367442],
                        [30.360482553302102, 142.0],
                        [30.0, 142.0],
                        [1.0, 142.0],
                        [1.0, 469.0],
                        [77.687158052792469, 469.0]
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "Right Wing" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [499.0, 469.0],
                        [499.0, 142.0],
                        [470.0, 142.0],
                        [469.63951744669788, 142.0],
                        [467.117704411400496, 148.020536891367442],
                        [463.993589573929228, 154.861394165133675],
                        [460.654001331216875, 161.599685649396264],
                        [457.102302365539003, 168.228626455811082],
                        [453.342068936689543, 174.741541802897302],
                        [449.37708728098994, 181.131873736976615],
                        [445.211349798870401, 187.393187735476658],
                        [440.849051034860906, 193.519179185949781],
                        [436.294583454040662, 199.503679734283423],
                        [431.552533019197767, 205.340663495709805],
                        [426.627674573153854, 211.024253122361102],
                        [421.524967030901621, 216.548725721260553],
                        [416.249548386398146, 221.908518616790502],
                        [410.806730539040359, 227.098234951835394],
                        [405.201993945032541, 232.112649121959208],
                        [399.440982099031828, 236.946712037146369],
                        [393.529495851626962, 241.595556205807213],
                        [387.473487568373969, 246.054500635929571],
                        [381.279055136268141, 250.319055548440815],
                        [374.952435823689029, 254.384926898034905],
                        [368.5, 258.248020696911965],
                        [361.928244721125793, 261.904447137076943],
                        [355.243787187568444, 265.3505245070466],
                        [348.45335808144705, 268.582782899020856],
                        [341.563794789271469, 271.597967702785809],
                        [340.69097862630872, 271.947390584522907],
                        [422.31284194720763, 469.0],
                        [499.0, 469.0]
                    ]
                ]
            }
        }
    ]
};

// 2. 進攻命中率數據
const offenseShotData = [{
        "team": "Average",
        "Restricted Area": 66.82,
        "Mid High Post": 45.19,
        "Left Wing": 35.63,
        "Top of the Key": 35.11,
        "Right Wing": 35.28,
        "Left Conor": 38.53,
        "Right Conor": 38.84,
        "Right Low Post": 43.14,
        "Left Low Post": 41.76,
        "Mid MidRange": 42.12,
        "MidRange Left Wing": 40.76,
        "MidRange Right Wing": 41.51,
        "MidRange Left Conor": 43.03,
        "MidRange Right Conor": 39.1
    },
    {
        "team": "ATL",
        "Restricted Area": 65.28,
        "Mid High Post": 47.1,
        "Left Wing": 35.57,
        "Top of the Key": 32.77,
        "Right Wing": 34.16,
        "Left Conor": 39.85,
        "Right Conor": 40.49,
        "Right Low Post": 43.17,
        "Left Low Post": 38.76,
        "Mid MidRange": 42.86,
        "MidRange Left Wing": 35.06,
        "MidRange Right Wing": 40.91,
        "MidRange Left Conor": 42.22,
        "MidRange Right Conor": 47.06
    },
    {
        "team": "BOS",
        "Restricted Area": 71.37,
        "Mid High Post": 43.9,
        "Left Wing": 38.24,
        "Top of the Key": 34.47,
        "Right Wing": 36.56,
        "Left Conor": 36.36,
        "Right Conor": 40.89,
        "Right Low Post": 41.11,
        "Left Low Post": 45.19,
        "Mid MidRange": 41.63,
        "MidRange Left Wing": 42.23,
        "MidRange Right Wing": 38.12,
        "MidRange Left Conor": 47.62,
        "MidRange Right Conor": 44.74
    },
    {
        "team": "BRK",
        "Restricted Area": 63.05,
        "Mid High Post": 39.92,
        "Left Wing": 36.23,
        "Top of the Key": 31.97,
        "Right Wing": 34.37,
        "Left Conor": 33.8,
        "Right Conor": 35.96,
        "Right Low Post": 40.24,
        "Left Low Post": 32.68,
        "Mid MidRange": 43.7,
        "MidRange Left Wing": 46.07,
        "MidRange Right Wing": 36.84,
        "MidRange Left Conor": 34.62,
        "MidRange Right Conor": 34.48
    },
    {
        "team": "CHI",
        "Restricted Area": 63.37,
        "Mid High Post": 50.83,
        "Left Wing": 37.17,
        "Top of the Key": 34.9,
        "Right Wing": 35.99,
        "Left Conor": 42.89,
        "Right Conor": 34.45,
        "Right Low Post": 46.5,
        "Left Low Post": 43.67,
        "Mid MidRange": 33.04,
        "MidRange Left Wing": 34.23,
        "MidRange Right Wing": 35.79,
        "MidRange Left Conor": 38.1,
        "MidRange Right Conor": 41.46
    },
    {
        "team": "CHO",
        "Restricted Area": 63.25,
        "Mid High Post": 38.11,
        "Left Wing": 32.99,
        "Top of the Key": 35.21,
        "Right Wing": 31.54,
        "Left Conor": 36.5,
        "Right Conor": 37.89,
        "Right Low Post": 41.28,
        "Left Low Post": 30.95,
        "Mid MidRange": 35.71,
        "MidRange Left Wing": 38.32,
        "MidRange Right Wing": 42.68,
        "MidRange Left Conor": 48.28,
        "MidRange Right Conor": 25.49
    },
    {
        "team": "CLE",
        "Restricted Area": 68.12,
        "Mid High Post": 51.55,
        "Left Wing": 38.82,
        "Top of the Key": 37.44,
        "Right Wing": 36.93,
        "Left Conor": 41.22,
        "Right Conor": 38.83,
        "Right Low Post": 45.83,
        "Left Low Post": 45.13,
        "Mid MidRange": 38.85,
        "MidRange Left Wing": 44.63,
        "MidRange Right Wing": 36.51,
        "MidRange Left Conor": 38.24,
        "MidRange Right Conor": 32.35
    },
    {
        "team": "DAL",
        "Restricted Area": 69.2,
        "Mid High Post": 46.34,
        "Left Wing": 38.53,
        "Top of the Key": 36.74,
        "Right Wing": 33.64,
        "Left Conor": 40,
        "Right Conor": 36.22,
        "Right Low Post": 41.28,
        "Left Low Post": 45.83,
        "Mid MidRange": 43.71,
        "MidRange Left Wing": 42.68,
        "MidRange Right Wing": 41.81,
        "MidRange Left Conor": 44.29,
        "MidRange Right Conor": 37.04
    },
    {
        "team": "DEN",
        "Restricted Area": 68.34,
        "Mid High Post": 47.82,
        "Left Wing": 37.34,
        "Top of the Key": 37.52,
        "Right Wing": 36.42,
        "Left Conor": 40.05,
        "Right Conor": 38.94,
        "Right Low Post": 50,
        "Left Low Post": 44.95,
        "Mid MidRange": 38.69,
        "MidRange Left Wing": 40.52,
        "MidRange Right Wing": 43.81,
        "MidRange Left Conor": 49.18,
        "MidRange Right Conor": 44.74
    },
    {
        "team": "DET",
        "Restricted Area": 66.31,
        "Mid High Post": 47.16,
        "Left Wing": 36.35,
        "Top of the Key": 36.3,
        "Right Wing": 34.84,
        "Left Conor": 37.18,
        "Right Conor": 37.94,
        "Right Low Post": 44.71,
        "Left Low Post": 44.13,
        "Mid MidRange": 42.86,
        "MidRange Left Wing": 30.89,
        "MidRange Right Wing": 38.18,
        "MidRange Left Conor": 46.34,
        "MidRange Right Conor": 39.29
    },
    {
        "team": "GSW",
        "Restricted Area": 66.7,
        "Mid High Post": 42.25,
        "Left Wing": 36.08,
        "Top of the Key": 35.27,
        "Right Wing": 35.84,
        "Left Conor": 36.72,
        "Right Conor": 40.17,
        "Right Low Post": 41.3,
        "Left Low Post": 42.82,
        "Mid MidRange": 32.04,
        "MidRange Left Wing": 40.68,
        "MidRange Right Wing": 40.85,
        "MidRange Left Conor": 46,
        "MidRange Right Conor": 31.43
    },
    {
        "team": "HOU",
        "Restricted Area": 65.11,
        "Mid High Post": 42.57,
        "Left Wing": 34.84,
        "Top of the Key": 34.84,
        "Right Wing": 36.71,
        "Left Conor": 37.1,
        "Right Conor": 36.34,
        "Right Low Post": 32.92,
        "Left Low Post": 41.67,
        "Mid MidRange": 41.78,
        "MidRange Left Wing": 42.78,
        "MidRange Right Wing": 38.24,
        "MidRange Left Conor": 25,
        "MidRange Right Conor": 38.71
    },
    {
        "team": "IND",
        "Restricted Area": 68.24,
        "Mid High Post": 48.66,
        "Left Wing": 33.43,
        "Top of the Key": 39.09,
        "Right Wing": 34.99,
        "Left Conor": 40.6,
        "Right Conor": 41.58,
        "Right Low Post": 50.51,
        "Left Low Post": 45.42,
        "Mid MidRange": 49.84,
        "MidRange Left Wing": 41.08,
        "MidRange Right Wing": 49.13,
        "MidRange Left Conor": 43.28,
        "MidRange Right Conor": 34.57
    },
    {
        "team": "LAC",
        "Restricted Area": 67.63,
        "Mid High Post": 46.53,
        "Left Wing": 38.22,
        "Top of the Key": 35.16,
        "Right Wing": 36.7,
        "Left Conor": 37.47,
        "Right Conor": 41.55,
        "Right Low Post": 50.34,
        "Left Low Post": 43.77,
        "Mid MidRange": 42.79,
        "MidRange Left Wing": 43.1,
        "MidRange Right Wing": 45.45,
        "MidRange Left Conor": 33.33,
        "MidRange Right Conor": 28.57
    },
    {
        "team": "LAL",
        "Restricted Area": 71.94,
        "Mid High Post": 42.78,
        "Left Wing": 35.93,
        "Top of the Key": 38.4,
        "Right Wing": 32.9,
        "Left Conor": 36.67,
        "Right Conor": 44.08,
        "Right Low Post": 44.23,
        "Left Low Post": 42.06,
        "Mid MidRange": 44.75,
        "MidRange Left Wing": 40.91,
        "MidRange Right Wing": 35.85,
        "MidRange Left Conor": 50,
        "MidRange Right Conor": 28.57
    },
    {
        "team": "MEM",
        "Restricted Area": 68.4,
        "Mid High Post": 46.92,
        "Left Wing": 34.88,
        "Top of the Key": 36.62,
        "Right Wing": 39.51,
        "Left Conor": 36.35,
        "Right Conor": 37.23,
        "Right Low Post": 42.62,
        "Left Low Post": 45.98,
        "Mid MidRange": 43.55,
        "MidRange Left Wing": 45.56,
        "MidRange Right Wing": 37.25,
        "MidRange Left Conor": 32.14,
        "MidRange Right Conor": 40
    },
    {
        "team": "MIA",
        "Restricted Area": 65.51,
        "Mid High Post": 45.96,
        "Left Wing": 36.15,
        "Top of the Key": 36.96,
        "Right Wing": 34.39,
        "Left Conor": 40.45,
        "Right Conor": 37.67,
        "Right Low Post": 42.32,
        "Left Low Post": 49.66,
        "Mid MidRange": 40,
        "MidRange Left Wing": 47.27,
        "MidRange Right Wing": 36.54,
        "MidRange Left Conor": 43.1,
        "MidRange Right Conor": 42.86
    },
    {
        "team": "MIL",
        "Restricted Area": 69.1,
        "Mid High Post": 45.36,
        "Left Wing": 36.71,
        "Top of the Key": 36.53,
        "Right Wing": 37.96,
        "Left Conor": 44.39,
        "Right Conor": 42.39,
        "Right Low Post": 43.67,
        "Left Low Post": 41.89,
        "Mid MidRange": 46.42,
        "MidRange Left Wing": 42.11,
        "MidRange Right Wing": 39.15,
        "MidRange Left Conor": 46.32,
        "MidRange Right Conor": 42.86
    },
    {
        "team": "MIN",
        "Restricted Area": 67.41,
        "Mid High Post": 42.02,
        "Left Wing": 36.73,
        "Top of the Key": 37.8,
        "Right Wing": 36.31,
        "Left Conor": 39.81,
        "Right Conor": 39.07,
        "Right Low Post": 40.52,
        "Left Low Post": 40.36,
        "Mid MidRange": 44.83,
        "MidRange Left Wing": 27.78,
        "MidRange Right Wing": 36.54,
        "MidRange Left Conor": 47.62,
        "MidRange Right Conor": 26.09
    },
    {
        "team": "NOP",
        "Restricted Area": 63.55,
        "Mid High Post": 41.42,
        "Left Wing": 35.14,
        "Top of the Key": 32.39,
        "Right Wing": 34.32,
        "Left Conor": 39.88,
        "Right Conor": 35.41,
        "Right Low Post": 41.82,
        "Left Low Post": 38.96,
        "Mid MidRange": 42.02,
        "MidRange Left Wing": 31.25,
        "MidRange Right Wing": 41.51,
        "MidRange Left Conor": 46.51,
        "MidRange Right Conor": 47.62
    },
    {
        "team": "NYK",
        "Restricted Area": 66.14,
        "Mid High Post": 47.28,
        "Left Wing": 36.47,
        "Top of the Key": 33.19,
        "Right Wing": 39.37,
        "Left Conor": 35.79,
        "Right Conor": 41.04,
        "Right Low Post": 44.29,
        "Left Low Post": 45.5,
        "Mid MidRange": 39.74,
        "MidRange Left Wing": 39.25,
        "MidRange Right Wing": 38.46,
        "MidRange Left Conor": 43.08,
        "MidRange Right Conor": 49.32
    },
    {
        "team": "OKC",
        "Restricted Area": 67.74,
        "Mid High Post": 46.33,
        "Left Wing": 34.59,
        "Top of the Key": 37.41,
        "Right Wing": 36.22,
        "Left Conor": 39.13,
        "Right Conor": 41.44,
        "Right Low Post": 46.98,
        "Left Low Post": 44.91,
        "Mid MidRange": 51.35,
        "MidRange Left Wing": 42.79,
        "MidRange Right Wing": 42.57,
        "MidRange Left Conor": 45.33,
        "MidRange Right Conor": 47.69
    },
    {
        "team": "ORL",
        "Restricted Area": 67.27,
        "Mid High Post": 41.23,
        "Left Wing": 29.74,
        "Top of the Key": 29.46,
        "Right Wing": 32.81,
        "Left Conor": 32.81,
        "Right Conor": 36.96,
        "Right Low Post": 40.84,
        "Left Low Post": 41.26,
        "Mid MidRange": 40.89,
        "MidRange Left Wing": 39.76,
        "MidRange Right Wing": 38.54,
        "MidRange Left Conor": 55.77,
        "MidRange Right Conor": 40
    },
    {
        "team": "PHI",
        "Restricted Area": 64.6,
        "Mid High Post": 45.3,
        "Left Wing": 33.7,
        "Top of the Key": 32.83,
        "Right Wing": 33.79,
        "Left Conor": 38.98,
        "Right Conor": 37.95,
        "Right Low Post": 39.37,
        "Left Low Post": 30.96,
        "Mid MidRange": 39.58,
        "MidRange Left Wing": 40.24,
        "MidRange Right Wing": 41.86,
        "MidRange Left Conor": 43.9,
        "MidRange Right Conor": 50
    },
    {
        "team": "PHO",
        "Restricted Area": 72.32,
        "Mid High Post": 47.91,
        "Left Wing": 37.11,
        "Top of the Key": 34.33,
        "Right Wing": 35.97,
        "Left Conor": 44.17,
        "Right Conor": 40.22,
        "Right Low Post": 46.21,
        "Left Low Post": 43.77,
        "Mid MidRange": 47.97,
        "MidRange Left Wing": 47.6,
        "MidRange Right Wing": 49.78,
        "MidRange Left Conor": 48.21,
        "MidRange Right Conor": 52.94
    },
    {
        "team": "POR",
        "Restricted Area": 64.02,
        "Mid High Post": 38.82,
        "Left Wing": 33.29,
        "Top of the Key": 32.66,
        "Right Wing": 35.1,
        "Left Conor": 34.43,
        "Right Conor": 36.5,
        "Right Low Post": 39.3,
        "Left Low Post": 27.98,
        "Mid MidRange": 45.26,
        "MidRange Left Wing": 47.17,
        "MidRange Right Wing": 48.89,
        "MidRange Left Conor": 25,
        "MidRange Right Conor": 34.21
    },
    {
        "team": "SAC",
        "Restricted Area": 69.95,
        "Mid High Post": 50.17,
        "Left Wing": 35.92,
        "Top of the Key": 32.54,
        "Right Wing": 35.17,
        "Left Conor": 42.12,
        "Right Conor": 36.94,
        "Right Low Post": 52.92,
        "Left Low Post": 46.96,
        "Mid MidRange": 43.28,
        "MidRange Left Wing": 43.45,
        "MidRange Right Wing": 44.68,
        "MidRange Left Conor": 47.83,
        "MidRange Right Conor": 36.21
    },
    {
        "team": "SAS",
        "Restricted Area": 67.14,
        "Mid High Post": 43.43,
        "Left Wing": 35.1,
        "Top of the Key": 34.81,
        "Right Wing": 34.13,
        "Left Conor": 37.7,
        "Right Conor": 40.71,
        "Right Low Post": 38.94,
        "Left Low Post": 42.08,
        "Mid MidRange": 41.23,
        "MidRange Left Wing": 38.6,
        "MidRange Right Wing": 44.56,
        "MidRange Left Conor": 28.21,
        "MidRange Right Conor": 31.58
    },
    {
        "team": "TOR",
        "Restricted Area": 62.62,
        "Mid High Post": 43.57,
        "Left Wing": 32.08,
        "Top of the Key": 33.97,
        "Right Wing": 35.69,
        "Left Conor": 36.36,
        "Right Conor": 39.4,
        "Right Low Post": 41.8,
        "Left Low Post": 35.05,
        "Mid MidRange": 38.62,
        "MidRange Left Wing": 38.74,
        "MidRange Right Wing": 33.71,
        "MidRange Left Conor": 44.44,
        "MidRange Right Conor": 46.81
    },
    {
        "team": "UTA",
        "Restricted Area": 68.18,
        "Mid High Post": 47.63,
        "Left Wing": 33.9,
        "Top of the Key": 35.19,
        "Right Wing": 30.4,
        "Left Conor": 39.88,
        "Right Conor": 40,
        "Right Low Post": 44.99,
        "Left Low Post": 41.5,
        "Mid MidRange": 32.52,
        "MidRange Left Wing": 35.25,
        "MidRange Right Wing": 43.22,
        "MidRange Left Conor": 35,
        "MidRange Right Conor": 33.33
    },
    {
        "team": "WAS",
        "Restricted Area": 67.82,
        "Mid High Post": 42.23,
        "Left Wing": 35.19,
        "Top of the Key": 32.83,
        "Right Wing": 32.76,
        "Left Conor": 35.22,
        "Right Conor": 33.07,
        "Right Low Post": 34.73,
        "Left Low Post": 30.82,
        "Mid MidRange": 35.32,
        "MidRange Left Wing": 43.59,
        "MidRange Right Wing": 43.64,
        "MidRange Left Conor": 32,
        "MidRange Right Conor": 20
    }
];

// 3. 防守命中率數據 (目前為空，等待您提供)
const defenseShotData = [{
        "team": "Average",
        "Restricted Area": 66.82,
        "Mid High Post": 45.19,
        "Left Wing": 35.63,
        "Top of the Key": 35.11,
        "Right Wing": 35.28,
        "Left Conor": 38.53,
        "Right Conor": 38.84,
        "Right Low Post": 43.14,
        "Left Low Post": 41.76,
        "Mid MidRange": 42.12,
        "MidRange Left Wing": 40.76,
        "MidRange Right Wing": 41.51,
        "MidRange Left Conor": 43.03,
        "MidRange Right Conor": 39.1
    },
    {
        "team": "ATL",
        "Restricted Area": 66.35,
        "Mid High Post": 46.41,
        "Left Wing": 37.52,
        "Top of the Key": 37.25,
        "Right Wing": 36.77,
        "Left Conor": 39.21,
        "Right Conor": 39.95,
        "Right Low Post": 45.07,
        "Left Low Post": 44.44,
        "Mid MidRange": 44.22,
        "MidRange Left Wing": 36.99,
        "MidRange Right Wing": 38.46,
        "MidRange Left Conor": 57.5,
        "MidRange Right Conor": 50
    },
    {
        "team": "BOS",
        "Restricted Area": 65.06,
        "Mid High Post": 44.02,
        "Left Wing": 33.85,
        "Top of the Key": 30.92,
        "Right Wing": 35.78,
        "Left Conor": 35.01,
        "Right Conor": 41.38,
        "Right Low Post": 42.51,
        "Left Low Post": 41.78,
        "Mid MidRange": 42.51,
        "MidRange Left Wing": 40.89,
        "MidRange Right Wing": 38.46,
        "MidRange Left Conor": 53.06,
        "MidRange Right Conor": 41.67
    },
    {
        "team": "BRK",
        "Restricted Area": 68.23,
        "Mid High Post": 47.94,
        "Left Wing": 37.09,
        "Top of the Key": 37.82,
        "Right Wing": 31.87,
        "Left Conor": 37.58,
        "Right Conor": 37.96,
        "Right Low Post": 47.47,
        "Left Low Post": 33.73,
        "Mid MidRange": 44.88,
        "MidRange Left Wing": 43.36,
        "MidRange Right Wing": 34.69,
        "MidRange Left Conor": 28.57,
        "MidRange Right Conor": 30.56
    },
    {
        "team": "CHI",
        "Restricted Area": 66.81,
        "Mid High Post": 46.6,
        "Left Wing": 35.85,
        "Top of the Key": 32.08,
        "Right Wing": 35.23,
        "Left Conor": 35.42,
        "Right Conor": 36.84,
        "Right Low Post": 40.15,
        "Left Low Post": 37.68,
        "Mid MidRange": 45.09,
        "MidRange Left Wing": 40,
        "MidRange Right Wing": 38.71,
        "MidRange Left Conor": 44.9,
        "MidRange Right Conor": 36.96
    },
    {
        "team": "CHO",
        "Restricted Area": 65.61,
        "Mid High Post": 48.07,
        "Left Wing": 35.5,
        "Top of the Key": 32.48,
        "Right Wing": 33.46,
        "Left Conor": 44.1,
        "Right Conor": 41.71,
        "Right Low Post": 40.38,
        "Left Low Post": 44.97,
        "Mid MidRange": 44.76,
        "MidRange Left Wing": 48.85,
        "MidRange Right Wing": 39.83,
        "MidRange Left Conor": 50,
        "MidRange Right Conor": 36.17
    },
    {
        "team": "CLE",
        "Restricted Area": 63.39,
        "Mid High Post": 44.36,
        "Left Wing": 36.91,
        "Top of the Key": 33.79,
        "Right Wing": 33.76,
        "Left Conor": 41.78,
        "Right Conor": 37.04,
        "Right Low Post": 41.92,
        "Left Low Post": 45.95,
        "Mid MidRange": 34.11,
        "MidRange Left Wing": 40.57,
        "MidRange Right Wing": 42.2,
        "MidRange Left Conor": 53.12,
        "MidRange Right Conor": 38.46
    },
    {
        "team": "DAL",
        "Restricted Area": 64.58,
        "Mid High Post": 45.02,
        "Left Wing": 35.45,
        "Top of the Key": 34.5,
        "Right Wing": 36.71,
        "Left Conor": 36.66,
        "Right Conor": 41.83,
        "Right Low Post": 42.25,
        "Left Low Post": 40.61,
        "Mid MidRange": 45.1,
        "MidRange Left Wing": 38.1,
        "MidRange Right Wing": 46.32,
        "MidRange Left Conor": 47.17,
        "MidRange Right Conor": 35.09
    },
    {
        "team": "DEN",
        "Restricted Area": 67.78,
        "Mid High Post": 44.65,
        "Left Wing": 35.62,
        "Top of the Key": 34.07,
        "Right Wing": 35.75,
        "Left Conor": 40.19,
        "Right Conor": 39.5,
        "Right Low Post": 42.02,
        "Left Low Post": 44.26,
        "Mid MidRange": 40.18,
        "MidRange Left Wing": 35.2,
        "MidRange Right Wing": 43.68,
        "MidRange Left Conor": 36.92,
        "MidRange Right Conor": 38
    },
    {
        "team": "DET",
        "Restricted Area": 64.51,
        "Mid High Post": 46.21,
        "Left Wing": 36.54,
        "Top of the Key": 37.63,
        "Right Wing": 36.4,
        "Left Conor": 37.95,
        "Right Conor": 35.47,
        "Right Low Post": 43,
        "Left Low Post": 37.72,
        "Mid MidRange": 48.6,
        "MidRange Left Wing": 44.79,
        "MidRange Right Wing": 41.4,
        "MidRange Left Conor": 34.48,
        "MidRange Right Conor": 48.15
    },
    {
        "team": "GSW",
        "Restricted Area": 68.29,
        "Mid High Post": 44.88,
        "Left Wing": 35.29,
        "Top of the Key": 36.19,
        "Right Wing": 35.59,
        "Left Conor": 37.31,
        "Right Conor": 43.07,
        "Right Low Post": 48.22,
        "Left Low Post": 47.69,
        "Mid MidRange": 39.42,
        "MidRange Left Wing": 45.39,
        "MidRange Right Wing": 43.4,
        "MidRange Left Conor": 44.62,
        "MidRange Right Conor": 42.86
    },
    {
        "team": "HOU",
        "Restricted Area": 66.46,
        "Mid High Post": 42.34,
        "Left Wing": 33.46,
        "Top of the Key": 36.32,
        "Right Wing": 37.03,
        "Left Conor": 35.24,
        "Right Conor": 38.94,
        "Right Low Post": 45.11,
        "Left Low Post": 38.08,
        "Mid MidRange": 36.11,
        "MidRange Left Wing": 38.22,
        "MidRange Right Wing": 38.41,
        "MidRange Left Conor": 35.85,
        "MidRange Right Conor": 25.64
    },
    {
        "team": "IND",
        "Restricted Area": 66.09,
        "Mid High Post": 46.51,
        "Left Wing": 34.51,
        "Top of the Key": 35.21,
        "Right Wing": 33.85,
        "Left Conor": 37.73,
        "Right Conor": 39.32,
        "Right Low Post": 46.56,
        "Left Low Post": 42.43,
        "Mid MidRange": 39.27,
        "MidRange Left Wing": 36.57,
        "MidRange Right Wing": 43.06,
        "MidRange Left Conor": 44.93,
        "MidRange Right Conor": 52.83
    },
    {
        "team": "LAC",
        "Restricted Area": 69.33,
        "Mid High Post": 43.89,
        "Left Wing": 34.77,
        "Top of the Key": 37.38,
        "Right Wing": 33.07,
        "Left Conor": 36.67,
        "Right Conor": 37.43,
        "Right Low Post": 37.79,
        "Left Low Post": 41.67,
        "Mid MidRange": 43.51,
        "MidRange Left Wing": 34.71,
        "MidRange Right Wing": 44.81,
        "MidRange Left Conor": 37.84,
        "MidRange Right Conor": 30.3
    },
    {
        "team": "LAL",
        "Restricted Area": 68.33,
        "Mid High Post": 45.02,
        "Left Wing": 35.48,
        "Top of the Key": 33.42,
        "Right Wing": 35.91,
        "Left Conor": 38.29,
        "Right Conor": 37.35,
        "Right Low Post": 35.95,
        "Left Low Post": 40.96,
        "Mid MidRange": 41.92,
        "MidRange Left Wing": 43.05,
        "MidRange Right Wing": 32.62,
        "MidRange Left Conor": 44.44,
        "MidRange Right Conor": 33.33
    },
    {
        "team": "MEM",
        "Restricted Area": 67.17,
        "Mid High Post": 41.02,
        "Left Wing": 34.93,
        "Top of the Key": 33.96,
        "Right Wing": 37.07,
        "Left Conor": 38.39,
        "Right Conor": 37.4,
        "Right Low Post": 42.61,
        "Left Low Post": 38,
        "Mid MidRange": 49.76,
        "MidRange Left Wing": 37.71,
        "MidRange Right Wing": 40.1,
        "MidRange Left Conor": 39.53,
        "MidRange Right Conor": 43.48
    },
    {
        "team": "MIA",
        "Restricted Area": 68.02,
        "Mid High Post": 46.56,
        "Left Wing": 38.08,
        "Top of the Key": 33.66,
        "Right Wing": 35.71,
        "Left Conor": 36.07,
        "Right Conor": 40.91,
        "Right Low Post": 43.55,
        "Left Low Post": 37.6,
        "Mid MidRange": 38.19,
        "MidRange Left Wing": 42.34,
        "MidRange Right Wing": 39.29,
        "MidRange Left Conor": 48.21,
        "MidRange Right Conor": 24.56
    },
    {
        "team": "MIL",
        "Restricted Area": 67.09,
        "Mid High Post": 44.65,
        "Left Wing": 33.61,
        "Top of the Key": 33.94,
        "Right Wing": 34.98,
        "Left Conor": 42.93,
        "Right Conor": 38.9,
        "Right Low Post": 42.3,
        "Left Low Post": 43.53,
        "Mid MidRange": 46.86,
        "MidRange Left Wing": 36.41,
        "MidRange Right Wing": 38.54,
        "MidRange Left Conor": 41.82,
        "MidRange Right Conor": 42.59
    },
    {
        "team": "MIN",
        "Restricted Area": 64.72,
        "Mid High Post": 42.93,
        "Left Wing": 34.32,
        "Top of the Key": 35.55,
        "Right Wing": 34.99,
        "Left Conor": 37.73,
        "Right Conor": 36.99,
        "Right Low Post": 45.95,
        "Left Low Post": 43.01,
        "Mid MidRange": 43.48,
        "MidRange Left Wing": 44.94,
        "MidRange Right Wing": 37.79,
        "MidRange Left Conor": 42.22,
        "MidRange Right Conor": 57.5
    },
    {
        "team": "NOP",
        "Restricted Area": 67.6,
        "Mid High Post": 48.86,
        "Left Wing": 36.01,
        "Top of the Key": 36.78,
        "Right Wing": 34.16,
        "Left Conor": 40.09,
        "Right Conor": 38.8,
        "Right Low Post": 44.65,
        "Left Low Post": 46.11,
        "Mid MidRange": 45.45,
        "MidRange Left Wing": 40.5,
        "MidRange Right Wing": 35.96,
        "MidRange Left Conor": 37.5,
        "MidRange Right Conor": 36.17
    },
    {
        "team": "NYK",
        "Restricted Area": 65.93,
        "Mid High Post": 46.17,
        "Left Wing": 35.54,
        "Top of the Key": 36.43,
        "Right Wing": 34.49,
        "Left Conor": 37.78,
        "Right Conor": 41.48,
        "Right Low Post": 42.86,
        "Left Low Post": 37.8,
        "Mid MidRange": 39.41,
        "MidRange Left Wing": 44.63,
        "MidRange Right Wing": 33.33,
        "MidRange Left Conor": 43.48,
        "MidRange Right Conor": 26.32
    },
    {
        "team": "OKC",
        "Restricted Area": 62.35,
        "Mid High Post": 45.4,
        "Left Wing": 32.33,
        "Top of the Key": 32.41,
        "Right Wing": 34.26,
        "Left Conor": 37.03,
        "Right Conor": 36.48,
        "Right Low Post": 43.81,
        "Left Low Post": 35.06,
        "Mid MidRange": 32.64,
        "MidRange Left Wing": 33.95,
        "MidRange Right Wing": 52.98,
        "MidRange Left Conor": 35.19,
        "MidRange Right Conor": 42.22
    },
    {
        "team": "ORL",
        "Restricted Area": 67.24,
        "Mid High Post": 42.49,
        "Left Wing": 37.16,
        "Top of the Key": 34.84,
        "Right Wing": 34.16,
        "Left Conor": 39.51,
        "Right Conor": 40.57,
        "Right Low Post": 39.06,
        "Left Low Post": 40.73,
        "Mid MidRange": 44.59,
        "MidRange Left Wing": 44.14,
        "MidRange Right Wing": 40.69,
        "MidRange Left Conor": 38.78,
        "MidRange Right Conor": 41.07
    },
    {
        "team": "PHI",
        "Restricted Area": 68.41,
        "Mid High Post": 42.91,
        "Left Wing": 39.98,
        "Top of the Key": 39.29,
        "Right Wing": 36.13,
        "Left Conor": 37.41,
        "Right Conor": 36.12,
        "Right Low Post": 44.09,
        "Left Low Post": 39.53,
        "Mid MidRange": 43.09,
        "MidRange Left Wing": 42.31,
        "MidRange Right Wing": 41.53,
        "MidRange Left Conor": 40,
        "MidRange Right Conor": 28.12
    },
    {
        "team": "PHO",
        "Restricted Area": 69.2,
        "Mid High Post": 45.68,
        "Left Wing": 36.82,
        "Top of the Key": 37.68,
        "Right Wing": 32.71,
        "Left Conor": 41.58,
        "Right Conor": 43.04,
        "Right Low Post": 45.71,
        "Left Low Post": 41.81,
        "Mid MidRange": 41.63,
        "MidRange Left Wing": 42.68,
        "MidRange Right Wing": 44.67,
        "MidRange Left Conor": 40.54,
        "MidRange Right Conor": 40.91
    },
    {
        "team": "POR",
        "Restricted Area": 66.24,
        "Mid High Post": 42.15,
        "Left Wing": 35.91,
        "Top of the Key": 35.42,
        "Right Wing": 35.3,
        "Left Conor": 38.32,
        "Right Conor": 37.43,
        "Right Low Post": 40.84,
        "Left Low Post": 43.15,
        "Mid MidRange": 44.54,
        "MidRange Left Wing": 47.67,
        "MidRange Right Wing": 50.9,
        "MidRange Left Conor": 46.27,
        "MidRange Right Conor": 41.03
    },
    {
        "team": "SAC",
        "Restricted Area": 68.13,
        "Mid High Post": 49.32,
        "Left Wing": 38.14,
        "Top of the Key": 40.21,
        "Right Wing": 37.31,
        "Left Conor": 39.12,
        "Right Conor": 37.59,
        "Right Low Post": 44.41,
        "Left Low Post": 47.91,
        "Mid MidRange": 36.13,
        "MidRange Left Wing": 36.03,
        "MidRange Right Wing": 39.6,
        "MidRange Left Conor": 42.86,
        "MidRange Right Conor": 49.02
    },
    {
        "team": "SAS",
        "Restricted Area": 65.22,
        "Mid High Post": 45.13,
        "Left Wing": 37.82,
        "Top of the Key": 36.32,
        "Right Wing": 34.32,
        "Left Conor": 36.99,
        "Right Conor": 39.69,
        "Right Low Post": 42.26,
        "Left Low Post": 52.9,
        "Mid MidRange": 40.1,
        "MidRange Left Wing": 41.51,
        "MidRange Right Wing": 43.35,
        "MidRange Left Conor": 48.08,
        "MidRange Right Conor": 34.15
    },
    {
        "team": "TOR",
        "Restricted Area": 67.37,
        "Mid High Post": 44.28,
        "Left Wing": 32.52,
        "Top of the Key": 33.33,
        "Right Wing": 36.61,
        "Left Conor": 39.04,
        "Right Conor": 36.34,
        "Right Low Post": 44.52,
        "Left Low Post": 36.05,
        "Mid MidRange": 32.45,
        "MidRange Left Wing": 44.8,
        "MidRange Right Wing": 42.57,
        "MidRange Left Conor": 41.3,
        "MidRange Right Conor": 38.89
    },
    {
        "team": "UTA",
        "Restricted Area": 70.11,
        "Mid High Post": 49.26,
        "Left Wing": 33.48,
        "Top of the Key": 34.19,
        "Right Wing": 37.77,
        "Left Conor": 41.75,
        "Right Conor": 36.86,
        "Right Low Post": 50,
        "Left Low Post": 49.22,
        "Mid MidRange": 49.5,
        "MidRange Left Wing": 44.93,
        "MidRange Right Wing": 44.14,
        "MidRange Left Conor": 50,
        "MidRange Right Conor": 51.52
    },
    {
        "team": "WAS",
        "Restricted Area": 70.95,
        "Mid High Post": 43.75,
        "Left Wing": 35.73,
        "Top of the Key": 33.29,
        "Right Wing": 36.86,
        "Left Conor": 39.63,
        "Right Conor": 41.12,
        "Right Low Post": 36.93,
        "Left Low Post": 35.61,
        "Mid MidRange": 46.88,
        "MidRange Left Wing": 36.81,
        "MidRange Right Wing": 49.69,
        "MidRange Left Conor": 38,
        "MidRange Right Conor": 28.89
    }
];

// 4. 籃球場背景圖片
const courtBackgroundImageUrl = 'img/basketball_court.png';

// --- 全域變數 ---
let leagueAverageOffense = {}; // 用來儲存聯盟平均進攻數據
let leagueAverageDefense = {}; // 用來儲存聯盟平均防守數據

let teamDataOffenseMap = new Map(); // 用 Map 儲存球隊進攻數據，方便查找
let teamDataDefenseMap = new Map(); // 用 Map 儲存球隊防守數據，方便查找

let offenseCanvas, offenseCtx;
let defenseCanvas, defenseCtx;

let teamSelector;
let teamNameDisplay;
let hotzoneTooltip; // 熱區提示框元素


// 新增一個 Image 物件來載入背景圖
const courtImage = new Image();
courtImage.src = courtBackgroundImageUrl;
courtImage.onload = () => {
    // 圖片載入完成後，如果已經有選定的球隊，則重新繪製熱區圖
    const selectedTeam = teamSelector.val();
    if (selectedTeam) {
        updateHotzoneDisplay(selectedTeam);
    }
    console.log("籃球場背景圖片載入完成。");
};
courtImage.onerror = () => {
    console.error("載入籃球場背景圖片失敗，請檢查路徑：", courtBackgroundImageUrl);
};

// --- 全局變數用於滑鼠互動 ---
let currentOffenseHoveredZone = null; // 追蹤進攻熱區當前懸停的分區
let currentDefenseHoveredZone = null; // 追蹤防守熱區當前懸停的分區

// --- 初始化熱區圖儀表板 ---
$(function() {
    initHotzoneDashboard();
});

function initHotzoneDashboard() {
    // ... (現有的 Canvas 和上下文獲取代碼) ...
    offenseCanvas = document.getElementById('offenseHotzoneCanvas');
    offenseCtx = offenseCanvas.getContext('2d');

    defenseCanvas = document.getElementById('defenseHotzoneCanvas');
    defenseCtx = defenseCanvas.getContext('2d');

    teamSelector = $('#team-selector');
    teamNameDisplay = $('#team-name-display');
    hotzoneTooltip = document.getElementById('hotzone-tooltip'); // 獲取提示框元素

    processShotData();
    populateTeamSelector();

    teamSelector.on('change', function() {
        const selectedTeam = $(this).val();
        updateHotzoneDisplay(selectedTeam);
    });

    $('.team-logo-item').on('click', function(e) {
        e.preventDefault();
        const teamId = $(this).data('team-id');
        if (teamId) {
            teamSelector.val(teamId);
            updateHotzoneDisplay(teamId);
            location.hash = '#team-dashboard';
        }
    });

    // 初始繪圖：確保圖片載入後才嘗試繪製
    // 這部分邏輯會被 courtImage.onload 處理，但為了首次載入，也可以在這裡呼叫
    // 如果圖片已經在快取中，onload 可能不會觸發，所以這裡也需要一個邏輯
    if (courtImage.complete && teamSelector.val()) {
        updateHotzoneDisplay(teamSelector.val());
    } else if (courtImage.complete && teamDataOffenseMap.size > 0) {
        const firstTeam = Array.from(teamDataOffenseMap.keys()).find(key => key !== 'Average');
        if (firstTeam) {
            teamSelector.val(firstTeam);
            updateHotzoneDisplay(firstTeam);
        }
    }
    // --- 新增滑鼠事件監聽 ---
    offenseCanvas.addEventListener('mousemove', (e) => handleCanvasMouseMove(e, offenseCanvas, 'offense'));
    offenseCanvas.addEventListener('mouseout', () => hideTooltip('offense'));

    defenseCanvas.addEventListener('mousemove', (e) => handleCanvasMouseMove(e, defenseCanvas, 'defense'));
    defenseCanvas.addEventListener('mouseout', () => hideTooltip('defense'));

}




// --- 數據處理函數 ---
function processShotData() {
    // 處理進攻數據
    offenseShotData.forEach(data => {
        if (data.team === "Average") {
            leagueAverageOffense = data;
        } else {
            teamDataOffenseMap.set(data.team, data);
        }
    });

    // 處理防守數據
    defenseShotData.forEach(data => {
        if (data.team === "Average") {
            leagueAverageDefense = data;
        } else {
            teamDataDefenseMap.set(data.team, data);
        }
    });

    console.log("聯盟平均進攻數據:", leagueAverageOffense);
    console.log("球隊進攻數據映射:", teamDataOffenseMap);
}

// --- 填充球隊選擇器下拉選單 ---
function populateTeamSelector() {
    teamSelector.empty(); // 清空現有選項
    teamSelector.append($('<option disabled selected value="">請選擇一支球隊</option>')); // 添加預設選項

    const teamNames = Array.from(teamDataOffenseMap.keys()).filter(team => team !== "Average").sort();
    teamNames.forEach(team => {
        teamSelector.append($('<option>', {
            value: team,
            text: team
        }));
    });
}

// --- 根據命中率差異獲取顏色 ---
function getColorForDifference(difference) {
    // difference 是百分點差異 (例如 +10, -5)
    if (difference >= 10) {
        return 'rgba(255, 0, 0, 0.7)'; // 紅色 (高 10 以上)
    } else if (difference >= 5) {
        return 'rgba(230, 100, 100, 0.7)'; // 淺紅色/橘色 (高 5 以上)
    } else if (difference <= -10) {
        return 'rgba(0, 0, 255, 0.7)'; // 藍色 (低 10 以上)
    } else if (difference <= -5) {
        return 'rgba(100, 100, 255, 0.4)'; // 淺藍色 (低 5 以上)
    } else {
        return 'rgba(255, 255, 100, 0.4)'; // 淡黃色 (介於高 5 ~ 低 5 之間)
    }
}

// --- 繪製球場熱區圖 ---
function drawCourt(canvasId, teamId, dataType) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) {
        console.error(`找不到 Canvas 元素: ${canvasId}`);
        return;
    }
    const ctx = canvas.getContext('2d');

    ctx.clearRect(0, 0, canvas.width, canvas.height); // 清空畫布

    // 繪製背景圖片
    if (courtImage.complete && courtImage.naturalWidth > 0) {
        // 將圖片繪製到整個 Canvas 上，自動縮放以適應
        ctx.drawImage(courtImage, 0, 0, canvas.width, canvas.height);
    } else {
        // 如果圖片未載入或載入失敗，則使用純色背景
        ctx.fillStyle = '#000'; // 黑色背景
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    ctx.strokeStyle = '#555'; // 邊框顏色
    ctx.lineWidth = 2; // 邊框寬度

    let teamData = null;
    let leagueAvgData = null;

    if (dataType === 'offense') {
        teamData = teamDataOffenseMap.get(teamId);
        leagueAvgData = leagueAverageOffense;
    } else if (dataType === 'defense') {
        // 確保 defenseShotData 和 teamDataDefenseMap 已被填充
        teamData = teamDataDefenseMap.get(teamId);
        leagueAvgData = leagueAverageDefense;
    }

    courtPolygonsData.features.forEach(feature => {
        const zoneName = feature.properties.name;
        const coordinates = feature.geometry.coordinates[0];

        let fillColor = 'rgba(128, 128, 128, 0.6)'; // 預設灰色 (無數據)

        let teamHitRate = null;
        // 檢查 teamData 是否存在，並且 teamData 物件中是否有 zoneName 這個屬性
        if (teamData && teamData.hasOwnProperty(zoneName)) {
            teamHitRate = teamData[zoneName];
        }

        let leagueAvgHitRate = null;
        // 檢查 leagueAvgData 是否存在，並且 leagueAvgData 物件中是否有 zoneName 這個屬性
        if (leagueAvgData && leagueAvgData.hasOwnProperty(zoneName)) {
            leagueAvgHitRate = leagueAvgData[zoneName];
        }

        // 只有當兩者都有有效數據時才計算差異並上色
        if (teamHitRate !== null && leagueAvgHitRate !== null) {
            const difference = teamHitRate - leagueAvgHitRate;
            fillColor = getColorForDifference(difference);
        }

        ctx.beginPath();
        if (coordinates.length > 0) {
            ctx.moveTo(coordinates[0][0], coordinates[0][1]);
            for (let i = 1; i < coordinates.length; i++) {
                ctx.lineTo(coordinates[i][0], coordinates[i][1]);
            }
        }
        ctx.closePath();

        ctx.fillStyle = fillColor;
        ctx.fill();
        ctx.stroke();
    });
}

// --- 更新熱區圖顯示 ---
function updateHotzoneDisplay(teamId) {
    if (!teamId) {
        teamNameDisplay.text("請選擇一支球隊查看熱區圖");
        offenseCtx.clearRect(0, 0, offenseCanvas.width, offenseCanvas.height);
        defenseCtx.clearRect(0, 0, defenseCanvas.width, defenseCanvas.height);
        return;
    }

    teamNameDisplay.text(`${teamId} 球隊數據`); // 更新標題

    // 繪製進攻熱區圖
    drawCourt('offenseHotzoneCanvas', teamId, 'offense');

    // 繪製防守熱區圖
    drawCourt('defenseHotzoneCanvas', teamId, 'defense');
}

// --- 處理 Dimension 模板的頁面切換 ---
// 監聽 URL Hash 變化，以確保當直接訪問 #team-dashboard 時也能載入數據
$(window).on('hashchange', function() {
    if (location.hash === '#team-dashboard') {
        const selectedTeam = teamSelector.val();
        if (selectedTeam) {
            updateHotzoneDisplay(selectedTeam);
        } else {
            // 如果從其他頁面切換過來但沒有選擇球隊，預設顯示第一個球隊
            const firstTeam = Array.from(teamDataOffenseMap.keys()).find(key => key !== 'Average');
            if (firstTeam) {
                teamSelector.val(firstTeam);
                updateHotzoneDisplay(firstTeam);
            }
        }
    }
});

// --- 輔助函數：獲取滑鼠在 Canvas 上的坐標 ---
function getMousePos(canvas, evt) {
    const rect = canvas.getBoundingClientRect(); // 獲取 Canvas 的大小和位置
    return {
        x: evt.clientX - rect.left,
        y: evt.clientY - rect.top
    };
}

// --- 輔助函數：判斷點是否在多邊形內 (Ray Casting Algorithm) ---
function isPointInPolygon(point, polygon) {
    // point = [x, y]
    // polygon = [[x1, y1], [x2, y2], ...]
    let x = point.x,
        y = point.y;
    let inside = false;
    for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
        let xi = polygon[i][0],
            yi = polygon[i][1];
        let xj = polygon[j][0],
            yj = polygon[j][1];

        // 判斷射線是否與邊相交
        let intersect = ((yi > y) != (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
    }
    return inside;
}

// --- 滑鼠移動事件處理函數 ---
function handleCanvasMouseMove(e, canvas, dataType) {
    const mousePos = getMousePos(canvas, e);
    const currentTeamId = teamSelector.val();

    let teamDataMap = (dataType === 'offense') ? teamDataOffenseMap : teamDataDefenseMap;
    let leagueAvgDataMap = (dataType === 'offense') ? leagueAverageOffense : leagueAverageDefense;
    let currentHoveredTracker = (dataType === 'offense') ? currentOffenseHoveredZone : currentDefenseHoveredZone;

    let hoveredZone = null;

    // 遍歷所有熱區分區，判斷滑鼠是否在其中一個多邊形內
    for (const feature of courtPolygonsData.features) {
        const zoneName = feature.properties.name;
        const coordinates = feature.geometry.coordinates[0]; // 獲取多邊形的坐標

        if (isPointInPolygon(mousePos, coordinates)) {
            hoveredZone = zoneName;
            break; // 找到第一個就跳出迴圈
        }
    }

    if (hoveredZone && hoveredZone !== currentHoveredTracker) {
        // 只有當滑鼠進入一個新的分區時才更新和顯示提示框
        const zoneName = hoveredZone;
        // 檢查 teamDataMap.get(currentTeamId) 是否存在，然後再訪問其屬性
        const teamSpecificData = teamDataMap.get(currentTeamId);
        const teamHitRate = teamSpecificData ? teamSpecificData[zoneName] : undefined;

        // 檢查 leagueAvgDataMap 是否存在，然後再訪問其屬性
        const leagueAvgHitRate = leagueAvgDataMap ? leagueAvgDataMap[zoneName] : undefined;

        let displayTeamRate = '無數據';
        let displayLeagueRate = '無數據';
        let displayDifference = '無數據';
        let differenceClass = ''; // 用於 CSS 顏色類別

        if (teamHitRate !== undefined && leagueAvgHitRate !== undefined) {
            const difference = teamHitRate - leagueAvgHitRate;
            displayTeamRate = `${teamHitRate.toFixed(2)}%`;
            displayLeagueRate = `${leagueAvgHitRate.toFixed(2)}%`;
            displayDifference = `${difference.toFixed(2)}%`;

            if (difference > 0) {
                displayDifference = `+${displayDifference}`;
                differenceClass = 'positive-diff'; // 紅色
            } else if (difference < 0) {
                differenceClass = 'negative-diff'; // 藍色
            } else {
                differenceClass = 'neutral-diff'; // 黃色
            }
        }

        const tooltipContent = `
            <strong>分區名稱：</strong> ${zoneName}<br>
            <strong>聯盟平均命中率：</strong> ${displayLeagueRate}<br>
            <strong>當前球隊命中率：</strong> ${displayTeamRate}<br>
            <strong>命中率正負值：</strong> <span class="${differenceClass}">${displayDifference}</span>
        `;

        showTooltip(e.clientX, e.clientY, tooltipContent);

        // 更新當前懸停的分區
        if (dataType === 'offense') {
            currentOffenseHoveredZone = hoveredZone;
        } else {
            currentDefenseHoveredZone = hoveredZone;
        }

    } else if (!hoveredZone && currentHoveredTracker) {
        // 如果滑鼠離開了當前懸停的分區
        hideTooltip(dataType);
    }
}

// --- 顯示提示框 ---
function showTooltip(x, y, content) {
    hotzoneTooltip.innerHTML = content;

    // 暫時顯示提示框以獲取其寬度和高度
    hotzoneTooltip.style.display = 'block';
    hotzoneTooltip.style.visibility = 'hidden'; // 暫時隱藏，不影響佈局

    const tooltipWidth = hotzoneTooltip.offsetWidth;
    const tooltipHeight = hotzoneTooltip.offsetHeight;

    // 獲取視窗的寬度和高度
    const windowWidth = window.innerWidth || document.documentElement.clientWidth;
    const windowHeight = window.innerHeight || document.documentElement.clientHeight;

    let finalX = x + 15; // 預設向右偏移
    let finalY = y + 15; // 預設向下偏移

    // 判斷是否超出右邊界
    if (finalX + tooltipWidth > windowWidth - 10) { // 留 10px 邊距
        finalX = x - tooltipWidth - 15; // 如果超出，則將提示框移到滑鼠左側
        // 確保不會超出左邊界（如果滑鼠剛好在左邊邊緣，但提示框很大）
        if (finalX < 10) { // 如果調整到左邊還是超出，那就靠右對齊視窗
            finalX = windowWidth - tooltipWidth - 10;
        }
    }

    // 判斷是否超出下邊界 (如果需要，也可以處理上方，這裡只處理右側)
    // 雖然您主要提到右側，但底部也可能超出
    if (finalY + tooltipHeight > windowHeight - 10) { // 留 10px 邊距
        finalY = y - tooltipHeight - 15; // 如果超出，則將提示框移到滑鼠上方
        // 確保不會超出上邊界
        if (finalY < 10) {
            finalY = 10; // 直接靠上邊界
        }
    }


    hotzoneTooltip.style.left = `${finalX}px`;
    hotzoneTooltip.style.top = `${finalY}px`;
    hotzoneTooltip.style.visibility = 'visible'; // 顯示提示框
}

// --- 隱藏提示框 ---
function hideTooltip(dataType) {
    if (dataType === 'offense') {
        currentOffenseHoveredZone = null;
    } else {
        currentDefenseHoveredZone = null;
    }
    // 只有當兩個 Canvas 都沒有懸停分區時才隱藏提示框
    // 這可以防止在兩個 Canvas 之間快速移動時閃爍
    if (currentOffenseHoveredZone === null && currentDefenseHoveredZone === null) {
        hotzoneTooltip.style.display = 'none';
    }
}